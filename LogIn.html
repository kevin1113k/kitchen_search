<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>衛生稽查智慧實境教育訓練 後台成績查詢系統</title>
    
    <style type="text/css">
        .bg{
          
          
          background-image:url("UI/BG_login.png");
          background-repeat: no-repeat;
          background-size: cover;
          position: absolute;
          height: 100vh;
          width: 100vw;
          background-position: center center;
          background-attachment:fixed;
          top: 0;
          
        }
        .inputUsername{
            max-height: 100%;  
            max-width: 100%; 
            width: 40%;
            height: 10%;
            position: absolute;    
            bottom: 160px;  
            left: 10%;  
            right: 0;  
            margin: auto;
        }
        .inputPwd{
            max-height: 100%;  
            max-width: 100%; 
            width: 40%;
            height: 10%;
            position: absolute;   
            bottom: 70px;  
            left: 10%;  
            right: 0;  
            margin: auto;
        }
        .LoginBt
        {
            width: 110px;
            height: 110px;
            cursor: pointer;
            border: none;
            background-image:url("UI/button_login.png");
            background-color: rgba(0, 0, 0, 0);
            position:absolute;
            bottom: 50px;  
        }
        .LoginBtdiv
        {
            width: 800px;
            height: 260px;
            border: none;
            position:absolute;
            background-color: rgba(0, 0, 0, 0);
            bottom: 150px; 
        }
        .number1
        {
            
            
            width: auto;
            height: auto;
            position: absolute;  
            top: 0;  
            bottom: 0; 
            align-items: center;  
            
            
        }
        .number1div
        {
            
            background-color: rgba(0, 0, 0, 0);
            width: 100px;
            height: 100px;
            position: absolute;  
            top: 0;  
            bottom: 0; 
            align-items: center;  
            
            
        }
        .full{
            width: 100%;
            height: 50%;
            border: black;
            background-color: rgba(0, 0, 255, 0);
            position:absolute;
            bottom: 0;  
            display: flex;
            justify-content: center; 
            align-items: center;  
  
        }
        .Logintest
        {
            width: 110px;
            height: 110px;
            cursor: pointer;
            border: none;
            background-image:url("UI/button_login.png");
            background-color: rgba(0, 0, 0, 0);
            position:absolute;
            left: 0;  
        }
      </style>
</head>
<body>
    <div class="bg">
        <div class="full">
          
        
        <input class="LoginBt" type="button" onclick="divFunction()">
        <div class="LoginBtdiv">
            <img class="number1" src="UI\login_frame.png"></img>
            <input  id="account" class="inputUsername" type="text" style="font-size:16px" onkeyup="value=value.replace(/[^\w=@#]|_/ig,'')">
            <input  id="password" class="inputPwd"  type="password" style="font-size:16px" onkeyup="value=value.replace(/[^\w=@#]|_/ig,'')">
        </div>    
          
            
        
    
    
        </div>
    </div>

    

    <script src='https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js'></script>
    
    <script>
        const accountInput = document.getElementById('account')
        const passwordInput = document.getElementById('password')
        var a,k
        
        

        $.ajax({
        type: "post",
        data: {
        "method": "read1",
        },
        url: "https://script.google.com/macros/s/AKfycbycAlTXduR_wNMMNQUuWxrFWFENZlp63jDVOQKmI54NAPcg5Z2e/exec", // 填入網路應用程式網址
        success: function (para) {
            /*if(para == passwordInput.value)
            {
                alert("pass");
            }
            else{
                alert("Error");
            }*/
            //k = para
        }
        });
        $.ajax({
            type: "post",
            data: {
            "method": "read",
            },
            url: "https://script.google.com/macros/s/AKfycbycAlTXduR_wNMMNQUuWxrFWFENZlp63jDVOQKmI54NAPcg5Z2e/exec", // 填入網路應用程式網址
            success: function (para) {
                /*if(para == passwordInput.value)
                {
                    alert("pass");
                }
                else{
                    alert("Error");
                }*/
            
                //alert(para);
            }
            });
        

    
    </script>

    <script>
        function divFunction() {
            const accountInput = document.getElementById('account')
            const passwordInput = document.getElementById('password')

            // 檢查是否被鎖定
            const lockTime = localStorage.getItem('ip_lock_time')
            if (lockTime && new Date(lockTime) > new Date()) {
            alert('該IP已被鎖定，請稍後再試')
            return
            }


            // 檢查帳號密碼是否正確
            $.ajax({
            type: 'post',
            data: {
            'method': 'write',
            'account': accountInput.value,
            'pwd': passwordInput.value,
            },
            url: 'https://script.google.com/macros/s/AKfycbycAlTXduR_wNMMNQUuWxrFWFENZlp63jDVOQKmI54NAPcg5Z2e/exec',
            success: function (para) {
            if (para === 'true') {
            // 登入成功，清除登入錯誤記錄
            localStorage.removeItem('ip_error_count')
            localStorage.removeItem('ip_lock_time')
            location.href = 'AchievementSearch.html'
            } else {
            // 登入失敗，增加登入錯誤次數
            const errorCount = Number(localStorage.getItem('ip_error_count')) || 0
            localStorage.setItem('ip_error_count', errorCount + 1)
            // 檢查是否超過登入錯誤次數限制
            if (errorCount >= 3) {
            const lockUntil = new Date()
            lockUntil.setMinutes(lockUntil.getMinutes() + 15)
            localStorage.setItem('ip_lock_time', lockUntil)
            alert('登入錯誤超過3次，該IP已被鎖定15分鐘')
            } else {
            alert('請確認帳號或密碼輸入正確')
                }
            }
            }
        })
        }
        

        function writeDataToGoogleSheet() {
            
            $.ajax({
            type: "post",
            data: {
            "method": "writecount",
            "account": "5566",
            },
            url: "https://script.google.com/macros/s/AKfycbycAlTXduR_wNMMNQUuWxrFWFENZlp63jDVOQKmI54NAPcg5Z2e/exec",
            success: function (para) {
                if(para == "true")
                {
                    alert("已成功修改帳號密碼");
                }
                
            }
            
            });
        }
    </script>
    
    
</body>
</html>